# Redis
## 1. redis 概述
redis是一款基于内存的key-value型的NoSql数据库，与关系型数据库不同的是，其基于key-value的形式存储。同时由于其基于内存，因此其IO速度远高于一般关系型数据库，官方宣称可以达到10wQPS。同时redis也支持数据的持久化和丰富的数据结构，因此redis在诸多环境中获得应用。
## 2. redis 持久化方案
redis与其他key-value数据库很大的不同点之一，就是其支持数据的持久化。这样，在关机之后，内存的数据也会保留在磁盘中。redis支持两种持久化方案：RDB和AOF。
### 2.1 RDB
RDB是redis每隔一个指定的时间持久化一次，这个时间可以自己配置。主要机制就是fork出一个子进程，每隔一定时间将内存中数据写到次磁盘中。
#### 2.1.1 RDB优点
1. 每隔一定是时间生成一份数据快照，这样以多个文件备份不同时间段的数据，非常适合做冷备份；
2. 对于redis正常的读写IO影响较小，以为redis只是fork一个子进程，让其完成和磁盘的IO
3. 非常适合数据恢复，只需要将rdb文件加载到内存即可。
#### 2.1.2 RDB缺点
1. RDB的缺点也很明显，因为是每隔一段时间备份一次，因此在这个时间间隔内，如果宕机，就会丢失这一时间段数据；
2. 当每次需要备份的数据较大时，对客户端提供服务可能会阻塞较长时间。因此，考虑性能，RDB备份方式的间隔时间不宜太长。
### 2.2 AOF
AOF是每次将对redis的写操作写入到日志文件中，并且是以append的方式写入，这样在重启的时候，直接回溯AOF的日志文件恢复数据即可。
#### 2.2.1 AOF优点
1. 相较于RDB方式，AOF的数据安全性更好。AOF一般每隔一秒，就会有后台进程执行一次fsync操作。也就是强制将OS Cache中的数据刷新到磁盘上。这样，及时宕机，丢失的数据也不会超过一秒；
2. 由于是append方式的写入日志，这样在一些误操作性的灾难恢复中，AOF或许会更有效。比如，误执行了一次flush db的操作，这时只需找到AOF日志文件，将最后一条指令删除即可；
3. AOF由于是append方式写日志，因此不用内存寻址。
4. 文件重写：每隔一段时间将redis中数据以命令的方式写到新的AOF日志文件中，不会去改变旧文件。这样可以去除一些过期命令和无效命令；同时也可以将多条命令合并。达到压缩文件的目的。
#### 2.2.2 AOF缺点
1. 首先是AOF的文件普遍比RDB文件大很多；
2. AOF持久化随着不通的的策略，会对正常redis的IO产生较大的影响。
   - no：不持久化，就不谈了。
   - everysec：每秒同步一次。正常环境的配置，每秒钟向磁盘刷新一次数据。QPS可以很高，同时数据的安全性也可以得到保障。
   - always：每次只要有写命令，就同步一次。对redis的IO有较大影响。同时也会减少磁盘寿命。
3. 在数据恢复上不如RDB方式，每次redis重启都需要回溯和执行日志中的命令。开销较大
## 3. redis 数据结构
### 3.1 string
### 3.2 hash
### 3.3 list
### 3.4 set
### 3.5 zset
## 4 redis的应用场景
### 4.1 缓存
### 4.2 分布式锁
### 4.3 消息队列